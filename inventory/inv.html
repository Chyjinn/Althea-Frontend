<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./css/style.css" type="text/css" />
	<script src="https://kit.fontawesome.com/2e18c099ce.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/progressbar.js/0.9.0/progressbar.min.js"></script>
</head>
<body>
<div class="content">

      <div class="inventory">
	  <div class="navigation">
		<image src="css/logo.png" class="logo">
		<input type="text" class="amount">
		<i id="section2" class="fa-solid fa-shirt navbuttons"></i>
		<i id="section1" class="fa-solid fa-key navbuttons"></i>
		<i id="section0" class="fa-solid fa-box navbuttons"></i>
		</div>
		
        <div id="inv-0" class="slotSpace">
          <div id="0;0" class="slot"></div>
          <div id="0;1" class="slot"></div>
          <div id="0;2" class="slot"></div>
          <div id="0;3" class="slot"></div>
          <div id="0;4" class="slot"></div>
          <div id="0;5" class="slot"></div>
          <div id="0;6" class="slot"></div>
          <div id="0;7" class="slot">
            <div class="item" id="wood">
              <img
                src="https://png.pngtree.com/png-vector/20220531/ourmid/pngtree-gun-magazine-icon-steel-isolated-png-image_4783868.png"
              />
              <div class="number">
                33
              </div>
            </div>
          </div>
          <div id="0;8" class="slot"></div>
          <div id="0;9" class="slot"></div>
          <div id="0;10" class="slot"></div>
          <div id="0;11" class="slot"></div>
          <div id="0;12" class="slot"></div>
          <div id="0;13" class="slot"></div>
          <div id="0;14" class="slot"></div>
          <div id="0;15" class="slot"></div>
          <div id="0;16" class="slot"></div>
          <div id="0;17" class="slot"></div>
          <div id="0;18" class="slot"></div>
          <div id="0;19" class="slot"></div>
          <div id="0;20" class="slot"></div>
          <div id="0;21" class="slot"></div>
          <div id="0;22" class="slot"></div>
          <div id="0;23" class="slot"></div>
          <div id="0;24" class="slot"></div>
          <div id="0;25" class="slot"></div>
          <div id="0;26" class="slot"></div>
		  <div id="0;27" class="slot"></div>
		  <div id="0;28" class="slot"></div>
		  <div id="0;29" class="slot"></div>
		  <div id="0;30" class="slot"></div>
		  <div id="0;31" class="slot"></div>
		  <div id="0;32" class="slot"></div>
		  <div id="0;33" class="slot"></div>
		  <div id="0;34" class="slot"></div>
		  <div id="0;35" class="slot"></div>
		  <div id="0;36" class="slot"></div>
		  <div id="0;37" class="slot"></div>
		  <div id="0;38" class="slot"></div>
		  <div id="0;39" class="slot"></div>
		  <div id="0;40" class="slot"></div>
		  <div id="0;41" class="slot"></div>
		  <div id="0;42" class="slot"></div>
		  <div id="0;43" class="slot"></div>
		  <div id="0;44" class="slot"></div>
		  <div id="0;45" class="slot"></div>
		  <div id="0;46" class="slot"></div>
		  <div id="0;47" class="slot"></div>
		  <div id="0;48" class="slot"></div>
		  <div id="0;49" class="slot"></div>
        </div>
		
		
		<div id="inv-1" class="slotSpace" >
          <div id="1;0" class="slot"></div>
          <div id="1;1" class="slot"></div>
          <div id="1;2" class="slot"></div>
          <div id="1;3" class="slot"></div>
          <div id="1;4" class="slot"></div>
          <div id="1;5" class="slot"></div>
          <div id="1;6" class="slot"></div>
          <div id="1;7" class="slot">
          </div>
          <div id="1;8" class="slot"></div>
          <div id="1;9" class="slot"></div>
          <div id="1;10" class="slot"></div>
          <div id="1;11" class="slot"></div>
          <div id="1;12" class="slot"></div>
          <div id="1;13" class="slot"></div>
          <div id="1;14" class="slot"></div>
          <div id="1;15" class="slot"></div>
          <div id="1;16" class="slot"></div>
          <div id="1;17" class="slot"></div>
          <div id="1;18" class="slot"></div>
          <div id="1;19" class="slot"></div>
          <div id="1;20" class="slot"></div>
          <div id="1;21" class="slot"></div>
          <div id="1;22" class="slot"></div>
          <div id="1;23" class="slot"></div>
          <div id="1;24" class="slot"></div>
          <div id="1;25" class="slot"></div>
          <div id="1;26" class="slot"></div>
		  <div id="1;27" class="slot"></div>
		  <div id="1;28" class="slot"></div>
		  <div id="1;29" class="slot"></div>
		  <div id="1;30" class="slot"></div>
		  <div id="1;31" class="slot"></div>
		  <div id="1;32" class="slot"></div>
		  <div id="1;33" class="slot"></div>
		  <div id="1;34" class="slot"></div>
		  <div id="1;35" class="slot">
		  <div class="item" id="wood">
              <img
                src="https://png.pngtree.com/png-vector/20220531/ourmid/pngtree-gun-magazine-icon-steel-isolated-png-image_4783868.png"
              />
              <div class="number">
                33
              </div>
            </div></div>
		  <div id="1;36" class="slot"></div>
		  <div id="1;37" class="slot"></div>
		  <div id="1;38" class="slot"></div>
		  <div id="1;39" class="slot"></div>
		  <div id="1;40" class="slot"></div>
		  <div id="1;41" class="slot"></div>
		  <div id="1;42" class="slot"></div>
		  <div id="1;43" class="slot"></div>
		  <div id="1;44" class="slot"></div>
		  <div id="1;45" class="slot"></div>
		  <div id="1;46" class="slot"></div>
		  <div id="1;47" class="slot"></div>
		  <div id="1;48" class="slot"></div>
		  <div id="1;49" class="slot"></div>
        </div>
		

		<div id="inv-2">
		
		<div id="wear">
		
		 <div id="hat" class="slot"><i class="fa-solid fa-hat-cowboy-side"></i></div>
		 <div id="mask" class="slot"><i class="fa-solid fa-mask"></i></div>
		 
		 
          <div id="glasses" class="slot"><i class="fa-solid fa-glasses"></i></div>
          <div id="ears" class="slot"><i class="fa-solid fa-headphones"></i></div>
		  
		  
		  
          
		  
		 
		 
		 
          <div id="polo" class="slot"><i class="fa-solid fa-shirt"></i></div>
          <div id="legs" class="slot"></div>
          <div id="feet" class="slot"><i class="fa-solid fa-socks"></i></div>
		  
		  
		  <div id="watch" class="slot"><i class="fa-solid fa-clock"></i></div>
          <div id="bracelet" class="slot"><i class="fa-solid fa-hand"></i></div>
		  <div id="accessories" class="slot"><i class="fa-solid fa-gem"></i></div>
		  
          <div id="bag" class="slot"><i class="fa-solid fa-briefcase"></i></div>
		  <div id="armor" class="slot"><i class="fa-solid fa-shield"></i></div>
		  
		  <div id="decal" class="slot"><i class="fa-solid fa-star"></i></div>
		</div>
		
		<div id="clothes">
		
		
		
          <div id="2;0" class="slot"></div>
          <div id="2;1" class="slot"></div>
          <div id="2;2" class="slot"></div>
          <div id="2;3" class="slot"></div>
          <div id="2;4" class="slot"></div>
          <div id="2;5" class="slot"></div>
          <div id="2;6" class="slot"></div>
          <div id="2;7" class="slot">

          </div>
          <div id="2;8" class="slot"></div>
          <div id="2;9" class="slot"></div>
          <div id="2;10" class="slot"></div>
          <div id="2;11" class="slot"></div>
          <div id="2;12" class="slot"></div>
          <div id="2;13" class="slot"></div>
          <div id="2;14" class="slot"></div>
          <div id="2;15" class="slot"></div>
          <div id="2;16" class="slot"></div>
          <div id="2;17" class="slot"></div>
          <div id="2;18" class="slot"></div>
          <div id="2;19" class="slot"></div>
          <div id="2;20" class="slot"></div>
          <div id="2;21" class="slot"></div>
          <div id="2;22" class="slot"></div>
          <div id="2;23" class="slot"></div>
          <div id="2;24" class="slot"></div>
          <div id="2;25" class="slot"></div>
          <div id="2;26" class="slot"></div>
		  <div id="2;27" class="slot"></div>
		  <div id="2;28" class="slot"></div>
		  <div id="2;29" class="slot"></div>
		  <div id="2;30" class="slot"></div>
		  <div id="2;31" class="slot"></div>
		  <div id="2;32" class="slot"></div>
		  <div id="2;33" class="slot"></div>
		  <div id="2;34" class="slot"></div>
		  <div id="2;35" class="slot"></div>
		  <div id="2;36" class="slot"></div>
		  <div id="2;37" class="slot"></div>
		  <div id="2;38" class="slot"></div>
		  <div id="2;39" class="slot"></div>
		  <div id="2;40" class="slot"></div>
		  <div id="2;41" class="slot"></div>
		  <div id="2;42" class="slot"></div>
		  <div id="2;43" class="slot"></div>
		  <div id="2;44" class="slot"></div>
		  <div id="2;45" class="slot"></div>
		  <div id="2;46" class="slot"></div>
		  <div id="2;47" class="slot"></div>
        </div>
		</div>
		<div id="weightbar"></div>
		
      </div>
	  <div id="tooltip">Valami tooltip.</div>
    </div>
	
    </body>
	<script>
let amount = 0;
let current_slot = null;
let status_click = false;
let current_itemId = null;
let current_itemType = null;
let current_itemValue = null;
const weightbar = document.getElementById('weightbar');
const tooltip = document.getElementById('tooltip');
var weight = new ProgressBar.Line(weightbar, {
  strokeWidth: 1,
  duration: 300,
  color: 'red',
  trailColor: 'white',
  trailWidth: 1,
  svgStyle: {width: '100%', height: '100%'}
});

weight.animate(0.5);
let actualweight = 0.5;
const sectioninv = document.querySelector('#inv-0');
const sectionkeys = document.querySelector('#inv-1');
const sectionclothes=  document.querySelector('#inv-2');


weightbar.addEventListener('mouseenter', displayToolTip);
weightbar.addEventListener('mouseleave', hideToolTip);


	function displayToolTip(){
		tooltip.innerHTML = (actualweight*100)+'%';
		tooltip.style.display = 'block';
		document.addEventListener('mousemove', moveToolTip);
	}
	
	
	function hideToolTip(){
		tooltip.style.display = 'none';
		document.removeEventListener('mousemove', moveToolTip);
	}


  function moveToolTip(event) {
    let x = event.clientX;
    let y = event.clientY;
    tooltip.style.left = x + 'px';
    tooltip.style.top = y + 'px';
  }

	let pages = document.querySelectorAll('.navbuttons');
	
	pages.forEach((item) => {
	  item.addEventListener('click', switchPage);
	  item.setAttribute('draggable', false);
	});
	
	function switchPage(event){
	console.log(event.target.id);
	switch(event.target.id) {
	  case 'section0'://fő ablak
		sectioninv.style.display = 'flex';
		sectionkeys.style.display = 'none';
		sectionclothes.style.display = 'none';
		console.log('vmi');
		break;
	  case 'section1'://kulcsok
		sectioninv.style.display = 'none';
		sectionkeys.style.display = 'flex';
		sectionclothes.style.display = 'none';
		break;
		case 'section2'://ruhák
		sectioninv.style.display = 'none';
		sectionkeys.style.display = 'none';
		sectionclothes.style.display = 'flex';
		break;
	  default:
    // code block
		}
	  pages.forEach((item) => {
	  item.style.color = 'white';
	  });
	  event.target.style.color = 'orange';

	}
	
	


let items = null;
const amountTextBox = document.querySelector('.amount');




function refreshInputValue(e){
if(e.target.value == '')
{
amount = 1;
}
else if(e.target.value >= 0){
amount = e.target.value;
}
else
{
amount = 0;
}
console.log(amount);
};

amountTextBox.addEventListener('input', refreshInputValue);


function moveItem() {
if(amount == 0 || amount > parseInt(this.lastElementChild.innerHTML)){

  event.preventDefault();
  const item = this;
  let waitItem = null;
  let ghostItem = item.cloneNode(true);
  ghostItem.setAttribute('class', 'ghostItem');
  item.classList.add('invisible');
  
  let shiftX = ghostItem.getBoundingClientRect().left + 20;
  let shiftY = ghostItem.getBoundingClientRect().top + 20;

  ghostItem.style.position = 'absolute';
  ghostItem.style.zIndex = 1000;
  document.body.append(ghostItem);

  ghostItem.onmouseup = function (event) {
    if (current_itemId && current_itemId != item.parentNode.id) {
      let area = document.getElementById(current_itemId);
      let free_space = !!!area.firstElementChild;

      if (free_space) {
        area.append(item);
      } else if (current_itemType == item.id) {
        let destiny = area.firstElementChild.lastElementChild.innerHTML;
        let origin = item.lastElementChild.innerHTML;
        let total = parseInt(destiny) + parseInt(origin);
        area.firstElementChild.lastElementChild.innerHTML = total;
        item.remove();
      } else {
        item.parentNode.append(area.firstElementChild);
        area.append(item);
      }
    }
    item && item.classList.remove('invisible');
    ghostItem.remove();
    status_click = false;
  };

  ghostItem.oncontextmenu = function (event) {
    event.preventDefault();
    if (current_itemId && current_itemId != item.parentNode.id) {
      let area = document.getElementById(current_itemId);
      let free_space = !!!area.firstElementChild;
      if (free_space) {
        let newItem = item.cloneNode(true);
        newItem.addEventListener('click', moveItem);
        newItem.addEventListener('contextmenu', moveItem);
        newItem.setAttribute('draggable', false);
        if (parseInt(item.lastElementChild.innerHTML) == 1) {
          ghostItem.remove();
          status_click = !status_click;
          item.remove();
        } else {
          item.lastElementChild.innerHTML =
            parseInt(item.lastElementChild.innerHTML) - 1;
          ghostItem.lastElementChild.innerHTML =
            parseInt(ghostItem.lastElementChild.innerHTML) - 1;
        }
        newItem.lastElementChild.innerHTML = 1;
        area.append(newItem);
        newItem.classList.remove('invisible');
      } else if (current_itemType == item.id) {
        if (parseInt(item.lastElementChild.innerHTML) == 1) {
          ghostItem.remove();
          status_click = !status_click;
          item.remove();
        }
        let destiny = parseInt(
          area.firstElementChild.lastElementChild.innerHTML
        );
        let origin = parseInt(item.lastElementChild.innerHTML);
        let ghost = parseInt(ghostItem.lastElementChild.innerHTML);

        area.firstElementChild.lastElementChild.innerHTML = destiny + 1;
        item.lastElementChild.innerHTML = origin - 1;
        ghostItem.lastElementChild.innerHTML = ghost - 1;
      }
    }
  };

  status_click = !status_click;

  if (status_click) {
    moveAt(event.pageX, event.pageY);
  }

  function moveAt(pageX, pageY) {
    ghostItem.style.left = pageX - shiftX + 'px';
    ghostItem.style.top = pageY - shiftY + 'px';
  }

  function onMouseMove(event) {
    if (status_click) {
      moveAt(event.pageX, event.pageY);
    }
    ghostItem.hidden = true;
    let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
	
    ghostItem.hidden = false;
	
    if (!elemBelow) return;
    let droppableBelow = elemBelow.closest('.slot');
	
    if (current_slot != droppableBelow) {
      if (current_slot) {
        leaveDroppable(current_slot);
      }
      current_slot = droppableBelow;
      if (current_slot) {
        enterDroppable(current_slot);
      }
    }
  }

  document.addEventListener('mousemove', onMouseMove);
  
  }
  
  else if(parseInt(this.lastElementChild.innerHTML) >= parseInt(amount)){
   event.preventDefault();
  const item = this;
  let waitItem = null;
  let ghostItem = item.cloneNode(true);
  ghostItem.setAttribute('class', 'ghostItem');
  ghostItem.lastElementChild.innerHTML = amount;
  
  //ezt ki kell venni, helyette átírni a számát annyira amennyi van
  //ghostitem-nek meg az amount legyen a száma

  //item.classList.add('invisible');

  let shiftX = ghostItem.getBoundingClientRect().left + 20;
  let shiftY = ghostItem.getBoundingClientRect().top + 20;

  ghostItem.style.position = 'absolute';
  ghostItem.style.zIndex = 1000;
  document.body.append(ghostItem);

  ghostItem.onmouseup = function (event) {
    if (current_itemId && current_itemId != item.parentNode.id) {
      let area = document.getElementById(current_itemId);
      let free_space = !!!area.firstElementChild;
      if (free_space) {
        let newItem = item.cloneNode(true);
        newItem.addEventListener('mousedown', moveItem);
        newItem.setAttribute('draggable', false);
		newItem.lastElementChild.innerHTML = amount;
        if (parseInt(item.lastElementChild.innerHTML) <= amount) {
          ghostItem.remove();
          status_click = !status_click;
          item.remove();
        } else {
          item.lastElementChild.innerHTML =
            parseInt(item.lastElementChild.innerHTML - amount);
          ghostItem.lastElementChild.innerHTML =
            parseInt(ghostItem.lastElementChild.innerHTML);
        }
        newItem.lastElementChild.innerHTML = amount;
        area.append(newItem);
        newItem.classList.remove('invisible');
      } else if (current_itemType == item.id) {
	  console.log(item.lastElementChild.innerHTML);
		item.lastElementChild.innerHTML -= amount;
        if (parseInt(item.lastElementChild.innerHTML) < 1) {
          ghostItem.remove();
          status_click = false;
          item.remove();
        }
        let destiny = parseInt(
          area.firstElementChild.lastElementChild.innerHTML
        );
        area.firstElementChild.lastElementChild.innerHTML = parseInt(destiny) + parseInt(amount);
      }
    }
    item && item.classList.remove('invisible');
    ghostItem.remove();
    status_click = false;
  };

  status_click = !status_click;

  if (status_click) {
    moveAt(event.pageX, event.pageY);
  }

  function moveAt(pageX, pageY) {
    ghostItem.style.left = pageX - shiftX + 'px';
    ghostItem.style.top = pageY - shiftY + 'px';
  }

  function onMouseMove(event) {
    if (status_click) {
      moveAt(event.pageX, event.pageY);
    }
    ghostItem.hidden = true;
    let elemBelow = document.elementFromPoint(event.clientX, event.clientY);
	
    ghostItem.hidden = false;
	
    if (!elemBelow) return;
    let droppableBelow = elemBelow.closest('.slot');
	
    if (current_slot != droppableBelow) {
      if (current_slot) {
        leaveDroppable(current_slot);
      }
      current_slot = droppableBelow;
      if (current_slot) {
        enterDroppable(current_slot);
      }
    }
  }

  document.addEventListener('mousemove', onMouseMove);
  
  }
}


function enterDroppable(elem) {
  current_itemId = elem.id;
  if (elem.firstElementChild) {
    current_itemType = elem.firstElementChild.id;
    child = elem.firstElementChild;
    current_itemValue = child.lastElementChild.innerHTML;
  }
  if(status_click){
  elem.style.border = 'solid 1px darkblue';
  }
  else
  {
  elem.style.border = 'solid 1px orange';
  }
}

function leaveDroppable(elem) {
  current_itemId = null;
  current_itemType = null;
  current_itemValue = null;
  free_space = false;
  elem.style.border = 'solid 1px grey';

}



class Inventory{

constructor()
{
this.items = [];
}

addItem()
{

}

delItem()
{

}


clearInventory()
{
this.items = [];
}

}


let inv = new Inventory();
reloadInventory();
function reloadInventory()
{
	inv.clearInventory();
	items = document.querySelectorAll('.item');
	
	items.forEach((item) => {
	  item.addEventListener('mousedown', moveItem);
	  item.addEventListener('contextmenu', moveItem);
	  item.setAttribute('draggable', false);
	});
}


function addNewItem()
{
inv.addItem();
//ha már van a sloton valami item akkor nem egyezik a szerver-kliens inv -> újratölteni
}

function deleteItem()
{
inv.delItem();
//ha nem sikerült törölni akkor újratölteni az egészet, mert nem egyezik
}


function itemMoveToServer(beginSlot, endSlot, amount){
//átküldeni a szervernek az item move-ot
//ha nem egyezik valami akkor reloadInventory -> egész kliens oldal újratöltése szerver alapján
}

function useItemToServer(slot){
//átküldeni a szervernek hogy melyik sloton lévő itemet szeretnénk használni
//ha nem egyezik valami akkor reloadInventory -> egész kliens oldal újratöltése szerver alapján
}

    </script>
</html>